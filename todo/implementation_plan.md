# 圆桌会议系统实现计划

根据 `docs\项目要求\fix_program_ideas.md` 文件中的要求，我们需要实现以下功能。本文档将这些要求分解为详细的任务列表，并提供实现指南。

## 总体要求概述

1. 智能体自我介绍（限定300字以内）
2. 图片故事讲述与关键词提取
3. 智能体性格不限定
4. 关键词提取与KJ法分类
5. 剪纸文创产品设计场景
6. 设计卡牌生成与人类交互
7. 提示词生成纹样设计
8. 原型设计与迭代
9. 实操经验反馈与最终设计

## 详细任务分解

### 1. 智能体自我介绍功能

- [ ] **1.1 修改智能体基类**
  - [ ] 1.1.1 更新 `src/core/agent.py` 中的 `introduce()` 方法
  - [ ] 1.1.2 添加字数限制逻辑（300字以内）
  - [ ] 1.1.3 确保自我介绍内容保存到记忆模块

- [ ] **1.2 更新智能体提示词模板**
  - [ ] 1.2.1 修改 `src/config/prompts.py` 中的自我介绍提示词
  - [ ] 1.2.2 添加字数限制提示
  - [ ] 1.2.3 确保提示词不限定智能体性格

- [ ] **1.3 测试自我介绍功能**
  - [ ] 1.3.1 创建测试用例
  - [ ] 1.3.2 验证字数限制是否生效
  - [ ] 1.3.3 确保自我介绍内容符合要求

### 2. 图片故事讲述与关键词提取

- [ ] **2.1 实现图片处理功能**
  - [ ] 2.1.1 更新 `src/utils/image.py` 中的图片处理方法
  - [ ] 2.1.2 确保支持多种图片格式

- [ ] **2.2 实现智能体讲故事功能**
  - [ ] 2.2.1 在 `src/core/agent.py` 中添加 `tell_story_from_image()` 方法
  - [ ] 2.2.2 确保故事内容基于智能体身份和经验
  - [ ] 2.2.3 实现思维发散和联想功能

- [ ] **2.3 实现关键词提取功能**
  - [ ] 2.3.1 更新 `src/core/agent.py` 中的 `extract_keywords()` 方法
  - [ ] 2.3.2 确保每个智能体能提取自己的关键词
  - [ ] 2.3.3 实现关键词格式化输出

- [ ] **2.4 测试图片故事与关键词功能**
  - [ ] 2.4.1 准备测试图片
  - [ ] 2.4.2 验证故事生成功能
  - [ ] 2.4.3 验证关键词提取功能

### 3. 智能体性格不限定

- [ ] **3.1 更新智能体定义**
  - [ ] 3.1.1 修改 `src/agents/` 目录下的各智能体类
  - [ ] 3.1.2 根据表格信息设置智能体属性（年龄、背景、经验等）
  - [ ] 3.1.3 移除固定性格限定
  - [ ] 3.1.4 保留角色定位但允许更灵活的性格表现

- [ ] **3.2 更新提示词模板**
  - [ ] 3.2.1 修改 `src/config/prompts.py` 中的角色提示词
  - [ ] 3.2.2 移除性格限定词汇（如"理性消费者"、"环保主义者"）
  - [ ] 3.2.3 使用更开放的角色描述

- [ ] **3.3 实现增强的记忆机制**
  - [ ] 3.3.1 更新 `src/core/memory.py` 中的记忆存储和检索方法
  - [ ] 3.3.2 实现长期记忆功能，确保智能体记住整个对话过程
  - [ ] 3.3.3 添加记忆格式化方法，便于智能体引用之前的发言
  - [ ] 3.3.4 确保记忆在角色转换后保持连续性

- [ ] **3.4 改进角色转换机制**
  - [ ] 3.4.1 更新 `src/core/agent.py` 中的 `switch_role` 方法
  - [ ] 3.4.2 确保智能体转换为与原始身份不同的新角色
  - [ ] 3.4.3 在角色转换过程中保持记忆连续性
  - [ ] 3.4.4 更新角色转换提示词，强调思维方式转变而非完全角色替换

- [ ] **3.5 测试智能体性格表现和记忆能力**
  - [ ] 3.5.1 进行多轮对话测试
  - [ ] 3.5.2 验证智能体表现出多样化的性格特点
  - [ ] 3.5.3 测试智能体在角色转换后是否能够引用之前的发言
  - [ ] 3.5.4 确保角色定位仍然清晰

### 4. 关键词提取与KJ法分类

- [ ] **4.1 实现多智能体关键词收集**
  - [ ] 4.1.1 更新 `src/core/conversation.py` 中的关键词收集逻辑
  - [ ] 4.1.2 确保能收集所有智能体的关键词
  - [ ] 4.1.3 实现关键词汇总功能

- [ ] **4.2 实现KJ法关键词分类**
  - [ ] 4.2.1 更新 `src/core/kj_method.py` 中的分类算法
  - [ ] 4.2.2 实现关键词分组和上位概念提取
  - [ ] 4.2.3 确保分类结果符合KJ法原理

- [ ] **4.3 实现关键词输出格式**
  - [ ] 4.3.1 参考关键词图格式实现输出
  - [ ] 4.3.2 确保格式清晰易读
  - [ ] 4.3.3 实现关键词层级显示

- [ ] **4.4 实现关键词合并功能**
  - [ ] 4.4.1 添加用户输入关键词a的接口
  - [ ] 4.4.2 实现关键词b（KJ法结果）与关键词a的合并
  - [ ] 4.4.3 生成关键词c并用于角色扮演阶段

### 5. 剪纸文创产品设计场景

- [ ] **5.1 实现虚拟场景设置**
  - [ ] 5.1.1 在 `src/config/prompts.py` 中添加剪纸研讨会场景描述
  - [ ] 5.1.2 确保场景描述包含设计目标（对称剪纸风格的中国传统蝙蝠吉祥纹样）
  - [ ] 5.1.3 实现场景初始化功能

- [ ] **5.2 实现设计讨论功能**
  - [ ] 5.2.1 更新 `src/core/conversation.py` 中的讨论流程
  - [ ] 5.2.2 确保讨论围绕设计主题进行
  - [ ] 5.2.3 实现智能体间的设计交流

- [ ] **5.3 实现设计卡牌生成**
  - [ ] 5.3.1 添加 `generate_design_card()` 方法
  - [ ] 5.3.2 确保设计卡牌包含设计想法和要素
  - [ ] 5.3.3 实现设计卡牌1b的格式化输出

### 6. 设计卡牌生成与人类交互

- [ ] **6.1 实现设计卡牌展示**
  - [ ] 6.1.1 在命令行界面中添加设计卡牌展示功能
  - [ ] 6.1.2 确保卡牌内容清晰可读
  - [ ] 6.1.3 实现卡牌保存功能

- [ ] **6.2 实现人类输入接口**
  - [ ] 6.2.1 添加用户输入卡牌2的接口
  - [ ] 6.2.2 确保输入界面友好
  - [ ] 6.2.3 实现输入验证和错误处理

- [ ] **6.3 实现卡牌处理逻辑**
  - [ ] 6.3.1 添加卡牌数据结构
  - [ ] 6.3.2 实现卡牌存储和检索功能
  - [ ] 6.3.3 确保卡牌数据在系统中正确流转

### 7. 提示词生成纹样设计

- [ ] **7.1 实现提示词处理**
  - [ ] 7.1.1 添加提示词解析功能
  - [ ] 7.1.2 确保提示词包含必要的设计元素（对称剪纸风格的中国传统蝙蝠吉祥纹样）
  - [ ] 7.1.3 实现提示词优化功能

- [ ] **7.2 集成图像生成功能**
  - [ ] 7.2.1 研究并选择合适的图像生成API
  - [ ] 7.2.2 实现API调用接口
  - [ ] 7.2.3 确保生成的图像符合设计要求

- [ ] **7.3 实现原型1b生成**
  - [ ] 7.3.1 添加图像后处理功能
  - [ ] 7.3.2 确保生成的原型符合剪纸风格
  - [ ] 7.3.3 实现原型展示和保存功能

### 8. 原型设计与迭代

- [ ] **8.1 实现原型管理**
  - [ ] 8.1.1 添加原型数据结构
  - [ ] 8.1.2 实现原型存储和检索功能
  - [ ] 8.1.3 确保原型数据在系统中正确流转

- [ ] **8.2 实现原型合并功能**
  - [ ] 8.2.1 添加用户上传原型1a的接口
  - [ ] 8.2.2 实现原型1a和原型1b的合并逻辑
  - [ ] 8.2.3 生成原型2并提供展示

### 9. 实操经验反馈与最终设计

- [ ] **9.1 实现实操经验输入**
  - [ ] 9.1.1 添加用户输入实操经验的接口
  - [ ] 9.1.2 确保输入界面友好
  - [ ] 9.1.3 实现输入验证和错误处理

- [ ] **9.2 实现最终设计生成**
  - [ ] 9.2.1 整合实操经验、卡牌2和原型2
  - [ ] 9.2.2 生成原型3b和卡牌3b
  - [ ] 9.2.3 实现最终设计的展示和保存

- [ ] **9.3 实现关键词生成**
  - [ ] 9.3.1 基于最终设计生成10个关键词
  - [ ] 9.3.2 确保关键词与设计主题相关
  - [ ] 9.3.3 实现关键词展示和保存

## 实现优先级

1. **高优先级**
   - 智能体自我介绍功能
   - 图片故事讲述与关键词提取
   - 关键词提取与KJ法分类

2. **中优先级**
   - 智能体性格不限定
   - 剪纸文创产品设计场景
   - 设计卡牌生成与人类交互

3. **低优先级**
   - 提示词生成纹样设计
   - 原型设计与迭代
   - 实操经验反馈与最终设计

## 实现时间表

- **第一阶段（1-2周）**：完成高优先级任务
- **第二阶段（2-3周）**：完成中优先级任务
- **第三阶段（3-4周）**：完成低优先级任务
- **最终阶段（1周）**：系统集成、测试和优化

## 注意事项

1. 确保所有功能都有适当的错误处理
2. 保持代码模块化，便于后续扩展
3. 定期进行测试，确保功能正常
4. 记录实现过程中的问题和解决方案
5. 关注用户体验，确保界面友好易用
