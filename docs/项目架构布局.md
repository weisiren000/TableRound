# 圆桌会议项目架构布局

## 项目概述

圆桌会议是一个多智能体交互系统，支持多种AI模型，实现智能体之间的对话、讨论、关键词提取和角色扮演等功能。系统设计为模块化架构，便于扩展和维护。

## 目录结构

```
tableround/
├── src/                           # 源代码目录
│   ├── main.py                    # 主程序入口
│   ├── config/                    # 配置文件目录
│   │   ├── __init__.py
│   │   ├── settings.py            # 全局设置
│   │   ├── models.py              # 模型配置
│   │   └── prompts.py             # 提示词模板
│   │
│   ├── core/                      # 核心功能模块
│   │   ├── __init__.py
│   │   ├── agent.py               # 智能体基类
│   │   ├── memory.py              # 记忆模块
│   │   ├── conversation.py        # 对话管理
│   │   ├── kj_method.py           # KJ法关键词提取
│   │   └── god_view.py            # 上帝视角功能
│   │
│   ├── agents/                    # 智能体定义
│   │   ├── __init__.py
│   │   ├── craftsman.py           # 手工艺人
│   │   ├── consumer.py            # 消费者
│   │   ├── manufacturer.py        # 制造商人
│   │   └── designer.py            # 设计师
│   │
│   ├── models/                    # AI模型接口
│   │   ├── __init__.py
│   │   ├── base.py                # 模型基类
│   │   ├── openai.py              # OpenAI接口
│   │   ├── google.py              # Google接口
│   │   ├── anthropic.py           # Anthropic接口
│   │   ├── deepseek.py            # DeepSeek接口
│   │   └── openrouter.py          # OpenRouter接口
│   │
│   ├── utils/                     # 工具函数
│   │   ├── __init__.py
│   │   ├── stream.py              # 流式输出处理
│   │   ├── image.py               # 图像处理
│   │   ├── voting.py              # 投票机制
│   │   └── logger.py              # 日志工具
│   │
│   └── api/                       # API接口
│       ├── __init__.py
│       ├── routes.py              # 路由定义
│       └── handlers.py            # 请求处理
│
├── ui/                            # 用户界面
│   └── cli/                       # 命令行界面
│       └── terminal.py            # 终端交互
│
├── tests/                         # 测试目录
│   ├── __init__.py
│   ├── test_agents.py             # 智能体测试
│   ├── test_memory.py             # 记忆模块测试
│   ├── test_conversation.py       # 对话测试
│   └── test_models.py             # 模型接口测试
│
├── data/                          # 数据目录
│   ├── memories/                  # 记忆存储
│   ├── images/                    # 图片资源
│   └── keywords/                  # 关键词存储
│
├── docs/                          # 文档目录
│   ├── 项目要求/                  # 项目需求文档
│   ├── 相关数据/                  # 相关参考数据
│   ├── api/                       # API文档
│   └── 用户指南/                  # 用户使用指南
│
├── .env.example                   # 环境变量示例
├── .env                           # 环境变量文件
├── requirements.txt               # 依赖包列表
├── README.md                      # 项目说明
└── LICENSE                        # 许可证
```

## 模块说明

### 1. 核心模块 (core)

#### 1.1 智能体基类 (agent.py)
- 定义智能体的基本属性和方法
- 实现自我介绍、对话、关键词提取等通用功能
- 支持角色转换机制

#### 1.2 记忆模块 (memory.py)
- 实现短期和长期记忆存储
- 提供上下文管理
- 支持记忆检索和更新

#### 1.3 对话管理 (conversation.py)
- 管理多智能体之间的对话流程
- 实现对话顺序控制
- 处理认同、反对、补充等互动逻辑

#### 1.4 KJ法关键词提取 (kj_method.py)
- 实现KJ法关键词提取算法
- 支持关键词分类和汇总
- 提供关键词投票机制

#### 1.5 上帝视角功能 (god_view.py)
- 实现对话观察和干预
- 提供总结和引导功能
- 管理阶段转换

### 2. 智能体定义 (agents)

为每种角色实现特定的智能体类，继承自基类并添加特定功能：

#### 2.1 手工艺人 (craftsman.py)
- 专注于传统工艺和制作技巧
- 提供工艺相关的专业知识

#### 2.2 消费者 (consumer.py)
- 关注产品使用体验和价值
- 提供市场需求和用户反馈

#### 2.3 制造商人 (manufacturer.py)
- 关注生产可行性和成本
- 提供制造工艺和规模化建议

#### 2.4 设计师 (designer.py)
- 关注美学和创新设计
- 提供设计方案和视觉表达

### 3. 模型接口 (models)

#### 3.1 模型基类 (base.py)
- 定义通用的模型接口
- 实现流式输出处理
- 提供思维模型支持

#### 3.2 各厂商接口
- 实现与各AI提供商的API对接
- 处理不同模型的特殊需求
- 提供统一的调用方式

### 4. 工具函数 (utils)

#### 4.1 流式输出处理 (stream.py)
- 实现流式文本输出
- 处理多智能体并行输出

#### 4.2 图像处理 (image.py)
- 处理图片输入和分析
- 支持图像生成功能

#### 4.3 投票机制 (voting.py)
- 实现黑箱投票算法
- 处理投票结果统计

#### 4.4 日志工具 (logger.py)
- 提供系统日志记录
- 支持对话历史保存

### 5. API接口 (api)

#### 5.1 路由定义 (routes.py)
- 定义系统API路由
- 处理请求路由分发

#### 5.2 请求处理 (handlers.py)
- 实现API请求处理逻辑
- 提供数据验证和响应格式化

### 6. 用户界面 (ui)

#### 6.1 命令行界面 (cli)
- 提供基于终端的交互方式
- 实现完整的系统功能访问
- 支持智能体对话、关键词提取和角色转换
- 提供图片处理和剪纸设计功能
- 实现流式文本输出

##### 6.1.1 终端交互 (terminal.py)
- 提供用户友好的命令行菜单
- 实现智能体创建和初始化
- 管理对话流程和用户输入
- 处理图片输入和分析
- 支持剪纸文创产品设计

## 数据流程

1. **初始化阶段**
   - 加载配置和模型
   - 初始化智能体
   - 准备记忆模块

2. **阶段1: 智能体讨论**
   - 智能体自我介绍
   - 用户输入课题
   - 按顺序进行对话
   - 提取关键词
   - 黑箱投票

3. **等待阶段**
   - 上帝视角总结
   - 用户输入关键词

4. **阶段2: 角色转换**
   - 智能体角色随机转换
   - 带着记忆进行新一轮讨论
   - 再次提取关键词和投票

5. **图像处理阶段**
   - 用户输入图片
   - 智能体讲故事和联想
   - 生成设计方案

## 技术栈

- **编程语言**: Python 3.8+
- **数据存储**: SQLite/MongoDB
- **AI接口**:
  - OpenAI API (GPT-4, GPT-3.5)
  - Google API (Gemini)
  - Anthropic API (Claude)
  - DeepSeek API
  - OpenRouter API (多种开源模型)
  - Doubao API (图像生成)
- **图像处理**: Pillow, OpenCV
- **命令行界面**: 纯Python实现

## 扩展性考虑

1. **模型扩展**: 系统设计支持轻松添加新的AI模型提供商
2. **智能体扩展**: 可以方便地添加新的智能体角色
3. **功能扩展**: 模块化设计便于添加新功能
4. **界面扩展**: 支持添加新的用户界面方式

## 下一步计划

1. ✅ 搭建基础框架
2. ✅ 实现核心模块
3. ✅ 开发智能体定义
4. ✅ 集成AI模型接口
   - ✅ OpenAI
   - ✅ Google
   - ✅ Anthropic
   - ✅ DeepSeek
   - ✅ OpenRouter
5. ✅ 实现命令行界面
6. 🔄 测试和优化
   - ✅ 单元测试
   - 🔄 集成测试
   - 🔄 性能优化
7. 🔄 部署和文档完善
